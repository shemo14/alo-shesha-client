import React, { Component } from 'react';import {View, Text, Image, TouchableOpacity, Dimensions, SafeAreaView } from 'react-native';import { Button, Icon, Container, Header, Right, Body, Content, Footer, FooterTab, Left, Card, CardItem, List, ListItem, Badge } from 'native-base';import { DoubleBounce } from 'react-native-loader';import CONST from "../consts";import axios from "axios/index";import colors from "../consts/colors";import { MapView, Location, Permissions } from 'expo';import connect from "react-redux/es/connect/connect";import {getCart} from "../actions";const height = Dimensions.get('window').height;const width  = Dimensions.get('window').width;class GetLocation extends Component{	constructor(props){		super(props);		this.state = {			userLocation: [],			initMap: true,			params: this.props.navigation.state.params.params,		}	}	static navigationOptions = () => ({		drawerLabel: ()=> null	});	componentWillMount = async () => {		let { status } = await Permissions.askAsync(Permissions.LOCATION);		if (status !== 'granted') {			alert('صلاحيات تحديد موقعك الحالي ملغاه');		}else {			const { coords: { latitude, longitude } } = await Location.getCurrentPositionAsync({});			const userLocation = { latitude, longitude };			this.setState({  initMap: false, userLocation });			console.log(userLocation);		}	};	onRegionChange = region => {		this.setState({ userLocation: region });	};	renderLoader(){		if (this.state.initMap){			return (				<View style={{ alignItems: 'center', justifyContent: 'center', height: 500 }}>					<DoubleBounce size={20} color={colors.red} />				</View>			);		}		const { latitude, longitude } = this.state.userLocation;		return(			<View style={{ flex: 1 }}>				<MapView					style={{ flex: 1, height: height-120, width: width }}					initialRegion={{						latitude: this.state.userLocation.latitude,						longitude: this.state.userLocation.longitude,						latitudeDelta: 0.422,						longitudeDelta: 0.121,					}}					onRegionChangeComplete={this.onRegionChange}				/>				<View style={{ right: '50%', marginRight: -24, marginTop: -48, position: 'absolute', top: '50%' }}>					<Image style={{ height: 48, width: 48 }} resizeMode='center' source={require('../../assets/images/maps-and-flags.png')} />				</View>			</View>		)	}	makeOrder(){		if (this.state.params.products === undefined){			axios.post(CONST.url + 'reBuyOldOrder',				{					order_id: this.state.params.orderId,					lat: this.state.userLocation.latitude,					lng: this.state.userLocation.longitude,				}).then(response => {				if (response.data.value == 1){					this.props.navigation.navigate('confirmOrder')				}			})		} else{			axios.post(CONST.url + 'makeOrder',				{					user_id: this.props.user.id,					total_price: this.state.params.total,					data: JSON.stringify(this.state.params.products),					charge: this.state.params.charge,					lat: this.state.userLocation.latitude,					lng: this.state.userLocation.longitude,				}).then(response => {				if (response.data.value == 1){					this.props.navigation.navigate('confirmOrder')				}			})		}	}	render(){		return(			<Container>				<Header style={{ height: 70, backgroundColor: colors.wight, paddingTop: 15 }}>					<Right style={{ flex: 0 }}>						<Button transparent onPress={() => this.props.navigation.openDrawer()}>							<Icon name='menu' style={{ color: colors.gray, fontSize: 30, marginTop: 8, left: -10 }} />						</Button>					</Right>					<Body style={{ width: '100%', alignItems: 'center', alignSelf: 'center' }}>					<Text style={{ color: colors.gray, textAlign: 'center', marginRight: 20, fontSize: 18 }}>حدد موقعك</Text>					</Body>					<Left style={{ flex: 0 }}>						<Button transparent onPress={() => this.props.navigation.goBack()}>							<Icon name={'ios-arrow-back'} type='Ionicons' style={{ color: colors.gray, marginTop: 8 }} />						</Button>					</Left>				</Header>				<Content>					<View>						{ this.renderLoader() }					</View>					<View style={{ position: 'absolute', padding: 10, bottom: 10, zIndex: 999, width: '100%' }}>						<Button style={{ backgroundColor: '#ea5454', marginTop: 5, borderRadius: 8, width: '100%' }} onPress={() => this.makeOrder()} block>							<Text style={{ color: '#fff' }}>تأكيد العنوان</Text>						</Button>					</View>				</Content>				<Footer>					<FooterTab style={{ backgroundColor: colors.wight }}>						<Button vertical onPress={() => this.props.navigation.navigate('home')}>							<Icon name="home" type='FontAwesome' style={{ color: colors.gray }}/>							<Text style={{ color: colors.gray }}>الرئيسية</Text>						</Button>						<Button vertical onPress={() => this.props.navigation.navigate('orders')}>							<Icon name="shop" type='Entypo' style={{ color: colors.gray }}/>							<Text style={{ color: colors.gray }}>طلباتي</Text>						</Button>						<Button badge vertical onPress={() => this.props.navigation.navigate('cart')}>							<Badge style={{ width: 17, color: colors.red, left: -10, paddingTop: 0 }}><Text style={{ color: colors.wight, textAlign: 'center' }}>{ this.props.count }</Text></Badge>							<Icon type='Entypo' name="shopping-cart" style={{ color: colors.gray }} />							<Text style={{ color: colors.gray }}>السلة</Text>						</Button>						<Button vertical onPress={() => this.props.navigation.navigate('profile')}>							<Icon name="person" type='MaterialIcons' style={{ color: colors.gray }} />							<Text style={{ color: colors.gray }}>حسابي</Text>						</Button>					</FooterTab>				</Footer>			</Container>		)	}}const mapStateToProps = ({ profile, cart }) => {	return {		user: profile.user,		count: cart.count	};};export default connect(mapStateToProps)(GetLocation);